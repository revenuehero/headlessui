import P,{Fragment as d,createContext as m,useContext as f,useEffect as R,useMemo as c,useRef as E,useState as g}from"react";import{createPortal as G}from"react-dom";import{useEvent as x}from'../../hooks/use-event.js';import{useIsoMorphicEffect as y}from'../../hooks/use-iso-morphic-effect.js';import{useOnUnmount as b}from'../../hooks/use-on-unmount.js';import{useOwnerDocument as H}from'../../hooks/use-owner.js';import{useServerHandoffComplete as O}from'../../hooks/use-server-handoff-complete.js';import{optionalRef as _,useSyncRefs as L}from'../../hooks/use-sync-refs.js';import{usePortalRoot as F}from'../../internal/portal-force-root.js';import{env as M}from'../../utils/env.js';import{forwardRefWithAs as h,render as v}from'../../utils/render.js';let A=m(null);function ie(l){return P.createElement(A.Provider,{value:l.root},l.children)}function S(){try{return f(A)}catch{return null}}function U(l){let n=F(),u=S(),a=f(C),o=H(l),[t,r]=g(()=>{if(!n&&a!==null||M.isServer)return null;const e=u||(o==null?void 0:o.body)||null;let i=e==null?void 0:e.querySelector("#headlessui-portal-root");if(i)return i;if(o===null||e===null)return null;let s=o.createElement("div");return s.setAttribute("id","headlessui-portal-root"),e.appendChild(s)});return R(()=>{if(t===null)return;const e=u||(o==null?void 0:o.body);e!=null&&e.contains(t)||e==null||e.appendChild(t)},[t,o]),R(()=>{n||a!==null&&r(a.current)},[a,r,n]),t}let N=d;function D(l,n){let u=l,a=E(null),o=L(_(p=>{a.current=p}),n),t=H(a),r=U(a),[e]=g(()=>{var p;return M.isServer?null:(p=t==null?void 0:t.createElement("div"))!=null?p:null}),i=f(T),s=O();return y(()=>{!r||!e||r.contains(e)||(e.setAttribute("data-headlessui-portal",""),r.appendChild(e))},[r,e]),y(()=>{if(e&&i)return i.register(e)},[i,e]),b(()=>{var p;!r||!e||(e instanceof Node&&r.contains(e)&&r.removeChild(e),r.childNodes.length<=0&&((p=r.parentElement)==null||p.removeChild(r)))}),s?!r||!e?null:G(v({ourProps:{ref:o},theirProps:u,defaultTag:N,name:"Portal"}),e):null}let j=d,C=m(null);function k(l,n){let{target:u,...a}=l,t={ref:L(n)};return P.createElement(C.Provider,{value:u},v({ourProps:t,theirProps:a,defaultTag:j,name:"Popover.Group"}))}let T=m(null);function se(){let l=f(T),n=E([]),u=x(t=>(n.current.push(t),l&&l.register(t),()=>a(t))),a=x(t=>{let r=n.current.indexOf(t);r!==-1&&n.current.splice(r,1),l&&l.unregister(t)}),o=c(()=>({register:u,unregister:a,portals:n}),[u,a,n]);return[n,c(()=>function({children:r}){return P.createElement(T.Provider,{value:o},r)},[o])]}let w=h(D),J=h(k),fe=Object.assign(w,{Group:J});export{fe as Portal,ie as RHPortalRoot,se as useNestedPortals};
